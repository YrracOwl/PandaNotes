<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="utf-8">
  <style>
    html,body {
      height:99%;
      /* background-color: #F0F0F0; */
    }
    main {
      height: 99%;
      overflow-y: hidden;
    }
    #main {
      display: flex;
      flex-flow: row;
      width: 100%;
    }
    #markdeep_input {
        flex: 1 1 45%;
        width: 225px;
        height: 97%;
        font-family: monospace;
        margin-right: 10px;
        font-size: 20px;
    }
    #preview {
      flex: 1 1 55%;
      width: 275px;
    }
    #markdeep_preview {
      height: 100%;
      /* width: 100%; */
      overflow-y: auto;
      overflow-x: hidden;
      padding-right: 10px;
    }

    .md p {
        font-size: inherit;
        font-weight: normal;
        margin: 0 0 10px;
    }

    .md h1, .md h2, .md h3 {
        margin-top: 0;
        padding-top: 0;
    }

    .md h1:before, .md h2:before, .md h3:before {
        display: none;
    }

    .md h1 {
        font-size: 21px;
    }

    .md h2 {
        font-size: 18px;
    }

    .md h3 {
        font-size: 16px;
    }
  </style>
  <style>
    :root {
      --bg: #24262d;
      --text: #dfe3ff;
      --color1: #673ab7;
      --color2: #3f51b5;
      --divider: rgba(255,255,255,0.16);
    }

    .context {
      font-size: 0.875rem;
      color: var(--text);
      list-style: none;
      margin: 0;
      padding: 0.05em 0.25em;
      border: 1px solid transparent;
      border-right-color: rgba(255, 255, 255, 0.15);
      border-bottom-color: rgba(255, 255, 255, 0.15);
      border-left-color: rgba(0, 0, 0, 0.15);
      border-top-color: rgba(0, 0, 0, 0.15);
      border-radius: 5px;
      position: absolute;
      min-width: 16em;
      z-index: 1;
      background: linear-gradient(145deg, var(--color1), var(--color2));
      box-shadow: 2px 5px 16px -4px #141321;
      will-change: transform, opacity, filter;
      transition: transform, opacity, visibility, filter;
      transition-duration: 0.5s, 0.2s, 0.4s, 0.3s;
      transition-delay: 0.1s, 0s, 0.4s, 0.2s;
      transition-timing-function: ease;
      transform: rotate3d(-1, -1, 0, 30deg) scale(1);
      transform-origin: 0 0;
      opacity: 0;
      visibility: hidden;
      filter: blur(6px);
    }
    .context, .context * {
      -webkit-user-select: none;
        -moz-user-select: none;
          -ms-user-select: none;
              user-select: none;
      cursor: default;
    }
    .context.is-visible {
      opacity: 1;
      transform: none;
      transition-delay: 0s, 0s, 0s, 0s;
      visibility: visible;
      filter: none;
    }
    .context.sub {
      background: var(--color2);
      width: -webkit-max-content;
      width: -moz-max-content;
      width: max-content;
      min-width: 10em;
      left: 100%;
      top: -0.4em;
      transform: translateX(-0.7em);
      transition: transform, opacity, width, min-width, visibility;
      transition-timing-function: ease;
      transition-duration: 0.4s, 0.25s, 0.15s, 0.15s, 0.01s;
      transition-delay: 0.4s, 0.25s, 0.3s, 0.3s, 0.35s;
      overflow: hidden;
      filter: none;
    }
    .context.sub .f {
      transform: translateX(-2.25em);
    }
    .context.sub.oppositeX {
      right: 100%;
      left: auto;
      transform: translateX(0.7em);
    }
    .context.sub.oppositeY {
      top: auto;
      bottom: -0.4em;
    }
    .context > li {
      padding: 0.3em 1.5em 0.35em 2.8em;
      border-radius: 3px;
      position: relative;
    }
    .context > li:before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      right: 0;
      border-radius: 3px;
      z-index: -1;
      background-color: rgba(97, 97, 97, 0.37);
      mix-blend-mode: color-dodge;
      transition: opacity 0.15s cubic-bezier(0.55, 0.06, 0.68, 0.19);
      opacity: 0;
    }
    .context > li.hilight {
      font-weight: 500;
      padding-bottom: 0.5em;
      color: white;
    }
    .context > li:not(.context > li.nope):hover {
      color: white;
    }
    .context > li:not(.context > li.nope):hover:before {
      opacity: 1;
      transition: opacity 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .context > li:not(.context > li.nope):hover .sub {
      opacity: 1;
      transform: translateX(0);
      transition-delay: 0.2s, 0.25s, 0.2s, 0.2s, 0s;
      border-radius: 0 3px 3px 3px;
      visibility: visible;
    }
    .context > li:hover > .f, .context > li.hilight > .f {
      opacity: 1;
    }
    .context > li:last-child {
      margin-bottom: 0.25em;
    }
    .context > li:first-child {
      margin-top: 0.25em;
    }
    .context > li.nope {
      color: rgba(255, 255, 255, 0.3);
    }
    .context > li.active {
      -webkit-animation: flash 0.5s ease 1;
              animation: flash 0.5s ease 1;
    }
    .context > li:nth-of-type(1) {
      margin-top: 0.5em;
    }
    .context > li .f {
      opacity: 0.5;
      transition: all 0.2s ease;
    }
    .context > li i {
      font-style: normal;
      text-decoration: underline;
      -webkit-text-decoration-color: rgba(255, 255, 255, 0.35);
              text-decoration-color: rgba(255, 255, 255, 0.35);
    }
    .context .div {
      border-bottom: 1px solid var(--divider);
      padding: 0;
      margin-top: 0.3em;
      margin-bottom: 0.35em;
    }
    .context .f {
      font-style: normal;
      position: absolute;
      transform: translateX(-2.4em);
    }
    .context .f[class*=chevron-right] {
      right: 0;
      transform: none;
    }

    .f.f-circle {
      fill: red;
    }

    span.size {
      position: absolute;
      font-size: 0.675em;
      left: 1.2em;
      top: 0.8em;
      text-shadow: aliceblue;
    }

    @-webkit-keyframes flash {
      0% {
        background: rgba(255, 255, 255, 0);
      }
      7% {
        background: rgba(255, 255, 255, 0.2);
      }
      14% {
        background: rgba(255, 255, 255, 0);
      }
      21% {
        background: rgba(255, 255, 255, 0.3);
      }
    }

    @keyframes flash {
      0% {
        background: rgba(255, 255, 255, 0);
      }
      7% {
        background: rgba(255, 255, 255, 0.2);
      }
      14% {
        background: rgba(255, 255, 255, 0);
      }
      21% {
        background: rgba(255, 255, 255, 0.3);
      }
    }
  </style>
</head>
<body>
  <main id="main">
    <textarea id='markdeep_input'></textarea>
    <section id="preview" >
      <div id="markdeep_preview"></div>
      <!-- <iframe id="markdeep_preview" frameborder="0"></iframe> -->
    </section>
  </main>
  <ul class="context">
    <li class="top">
      <a href="https://www.jqueryscript.net/menu/">Menu</a> 1
      <ul class="context sub"> 
        <li title="Chosen: Red">
          Menu 1-1
        </li>
        <li title="Chosen: Xtra Large">
          Menu 1-2
        </li>
      </ul>
    </li>
    <li class="hilight">
      Menu 2 (Highlighted)
    </li>
    <li>
      Menu 3
    </li>
    <!-- Separator -->
    <li class="div"></li>
    <li>
      Menu 4
      <ul class="context sub"> 
        <li class="hilight">
          Menu 4-1
        </li>
        <li>
          Menu 4-2
        </li>
      </ul>
    </li>
  </ul>
  <div class="colors">
    <h4>Theme Switcher</h4>
    <input type="color" name="c1" id="c1" value="#673ab7"/>
    <input type="color" name="c2" id="c2" value="#3f51b5"/>
  </div>
  <script>window.markdeepOptions = {mode: 'script'};</script>
  <script type ="text/javascript" src="jquery.min.js"></script>
  <!-- <script type ="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script> -->
  <script type ="text/javascript" src="markdeep.min.js"></script>
  <!-- <script type ="text/javascript" src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script> -->
  <script type ="text/javascript" src="MathJax.js"></script>
  <!-- <script type ="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->
  <script>
  $(document).ready(function() {
    "use strict";
    document.head.innerHTML = window.markdeep.stylesheet() + document.head.innerHTML;

    $('#markdeep_input').on("change keyup paste", function() {
      var input = $('#markdeep_input').val() + "\n";
      $('#markdeep_preview').html(window.markdeep.format(input));  // <----------- magic
      postprocessMarkdeep();
    });

  });

  function postprocessMarkdeep() {
    // for some reason, markdeep creates an additional, superflous <p> tag right
    // at the beginning, so let's get rid of that
    $('.markdeep .md > p:first-child').hide();

    // anchors mess up the spacing, so purge them too
    $('.markdeep .md a.target').hide();

    // tell mathjax to render math
    $('.markdeep').each(function() {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, $(this).get()]);
    });
  }
  </script>
  <script>
    function saveMD() {
      var MDtext = $('#markdeep_input').val();
      // console.log(MDtext);
      return MDtext;
    };

    function initText(strs) {
      $('#markdeep_input').text(strs);
      var input = $('#markdeep_input').val() + "\n";
      $('#markdeep_preview').html(window.markdeep.format(input));  // <----------- magic
      postprocessMarkdeep();
    };

    function insertTxt(strs) {
      document.getElementById("markdeep_input").value = $('#markdeep_input').val() + "\n" + strs + "\n";
      var input = $('#markdeep_input').val() + "\n";
      $('#markdeep_preview').html(window.markdeep.format(input));  // <----------- magic
      postprocessMarkdeep();
    };
  </script>

  <!-- <script>
    /**
     * options:
     * {
     *  menus:[{
     *    name: string,
     *    onClick: Function
     *  }],
     * }
     */
    const ContextMenu = function (options) {
      let instance;

      function createMenu() {
        const ul = document.createElement("ul");
        ul.classList.add("custom-context-menu");
        const { menus } = options;
        if (menus && menus.length > 0) {
          for (let menu of menus) {
            const li = document.createElement("li");
            li.textContent = menu.name;
            li.onclick = menu.onClick;
            ul.appendChild(li);
          }
        }
        const body = document.querySelector("body");
        body.appendChild(ul);
        return ul;
      }

      return {
        getInstance: function () {
          if (!instance) {
            instance = createMenu();
          }
          return instance;
        },
      };
    };

    const contextMenu = ContextMenu({
      menus: [
        {
          name: "插入一级标题",
          onClick: function (e) {
            insertTxt("# 标题")
          },
        },
        {
          name: "插入二级标题",
          onClick: function (e) {
            insertTxt("## 标题");
          },
        },
        {
          name: "插入三级标题",
          onClick: function (e) {
            insertTxt("### 标题");
          },
        },
        {
          name: "插入无序列表",
          onClick: function (e) {
            insertTxt("- 无序列表，标记后面有空格\n- 可使用的标记有(-,*,+)\n- 可以嵌套使用\n\n");
          },
        },
        {
          name: "插入有序列表",
          onClick: function (e) {
            insertTxt("1. 有序列表，标记后面有空格\n1. 标记只要是数字即可\n2. 可以嵌套使用\n\n");
          },
        },
        {
          name: "插入链接",
          onClick: function (e) {
            insertTxt("[超链接](https://example.com)");
          },
        },
        {
          name: "插入待办",
          onClick: function (e) {
            insertTxt("[ ] 待办1\n\n[ ] 同级待办\n\n [x] 已完成子待办\n\n [ ] 同级子待办\n\n[x] ~~可以用删除线修饰~~\n[ ] 如果不空行\n[ ] 那么就是连续子待办\n\n");
          },
        },
        {
          name: "插入表格",
          onClick: function (e) {
            var tableStr = `
Maine | Iowa | Colorado 
-------|------|----------
   1   |  4   |   10
  ME   |  IA  |   CO
 Blue  | Red  | Brown
[Table [states]: Caption with label.]`;
            insertTxt(tableStr);
          },
        },
        {
          name: "插入图像",
          onClick: function (e) {
            insertTxt("![Figure [robot]: A picture of a robot](robot.jpg)");
          },
        },
        {
          name: "插入数字电路",
          onClick: function (e) {
            var circuitDigital = ```
Digital Circuits
--------------------------------------------------------------------------------

*************************************************************************************************
*                                 ____                      *                                   *
*                                |    |_____.---.           |                                   *
*                                o     _____|    )----------)-------.                           *
*                               / \   |     '---'           |     __|__                         *
*                              /___\  |                     |     \   /                         *
*                                |    '-------------.       |      \ /                          *
*              A ----------------'                  |       |       o                           *
*                   .-------------------.     o-----)-------'       |                           *
*                   |                   |___.---.   |               |___.---.                   *
*              B ---*---.__.---.         ___|    )--*--.__..---.     ____)   )----- Y           *
*                        __|    o----*--'   '---'    ______))   )---'   '---'                   *
*              C -------'  '---'     |              |     ''---'                                *
*                                    |              o                                           *
*                                    |             / \                                          *
*                                    |            /___\                                         *
*                                    |              |                                           *
*                                    '--------------'                                           *
*************************************************************************************************```;
            insertTxt(circuitDigital);
          },
        },
        {
          name: "插入模拟电路",
          onClick: function (e) {
            var circuitAnalog = ```
Analog Circuits
--------------------------------------------------------------------------------

*************************************************
*                                               *
*             k                  x₂             *
*     .---.╱╲╱╲╱╲╱'---.    .----->              *
*     |               |   .+.                   *
* ----+               *--+ m₂+--->              *
*     |      ---.     |   '-'    x₁             *
*     '--------┫+-----'                         *
*            ---'                               *
*              d                                *
*                                               *
*************************************************```;
            insertTxt(circuitAnalog);
          },
        },
        {
          name: "插入甘特图",
          onClick: function (e) {
            var GanttChart = ```
Gantt Chart
--------------------------------------------------------------------------------

*************************************************************************************************
*            ║ Preproduction┆       Alpha┆             RC1┆
* ═══════════╬══════════════╪════════════╪════════════════╪══
* Story      ║    ▆▆▆▆▆▆▆▆  ┆           ▆┆▆▆▆             ┆
* Concept Art║       └▆▆▆▆▆▆┆▆▆▆┐        ┆                ┆
* Modeling   ║              ┆   └▆▆▆▆▆▆▆▆┆▆▆▆▆▆▆▆         ┆
* Rigging    ║              ┆        └▆▆▆┆▆▆▆▆▆▆▆▆▆▆▆▆    ┆
* Mechanics  ║        ▆▆▆▆▆▆┆▆▆┐         ┆     ░░░░▆▆▆▆   ┆
* Engine Code║   ▆▆▆▆▆▆▆┐ │ ┆  └────────▆┆▆▆▆▆▆▆▆▆▆▆▆▆▆   ┆
* Game Code  ║          └─┴▆┆▆▆▆▆▆▆▆▆▆▆▆▆┆▆▆▆▆ ░░░░   ▆   ┆
*            ║              ┆            ┆    Freeze      ┆
*************************************************************************************************```;
            insertTxt(GanttChart);
          },
        },
      ],
    });

    function showMenu(e) {
      e.preventDefault();
      const menus = contextMenu.getInstance();
      menus.style.top = `${e.clientY}px`;
      menus.style.left = `${e.clientX}px`;
      menus.classList.remove("hidden");
    }

    function hideMenu(event) {
      const menus = contextMenu.getInstance();
      menus.classList.add("hidden");
    }

    document.addEventListener("contextmenu", showMenu);
    document.addEventListener("click", hideMenu);

  </script> -->
  <script>
    $(function () {
      var $doc = $(document),
        $context = $(".context:not(.sub)"),
        $c1 = $("#c1"),
        $c2 = $("#c2");

      $doc.on("contextmenu", function (e) {

        var $window = $(window),
          $sub = $context.find(".sub");

        $sub.removeClass("oppositeX oppositeY");

        e.preventDefault();

        var w = $context.width();
        var h = $context.height();
        var x = e.clientX;
        var y = e.clientY;
        var ww = $window.width();
        var wh = $window.height();
        var padx = 30;
        var pady = 20;
        var fx = x;
        var fy = y;
        var hitsRight = (x + w >= ww - padx);
        var hitsBottom = (y + h >= wh - pady);

        if (hitsRight) {
          fx = ww - w - padx;
        }

        if (hitsBottom) {
          fy = wh - h - pady;
        }

        $context
          .css({
            left: fx - 1,
            top: fy - 1
          });

        var sw = $sub.width();
        var sh = $sub.height();
        var sx = $sub.offset().left;
        var sy = $sub.offset().top;
        var subHitsRight = (sx + sw - padx >= ww - padx);
        var subHitsBottom = (sy + sh - pady >= wh - pady);

        if (subHitsRight) {
          $sub.addClass("oppositeX");
        }

        if (subHitsBottom) {
          $sub.addClass("oppositeY");
        }

        $context.addClass("is-visible");

        $doc.on("mousedown", function (e) {

          var $tar = $(e.target);
          console.log($tar)

          if (!$tar.is($context) &&
            !$tar.closest(".context").length &&
            !$tar.is($c1) &&
            !$tar.is($c2)) {

            $context.removeClass("is-visible");
            $doc.off(e);

          }

        });

      });

      $context.on("mousedown touchstart", "li:not(.nope)", function (e) {

        if (e.which === 1) {

          var $item = $(this);

          $item.removeClass("active");

          setTimeout(function () {
            $item.addClass("active");
          }, 10);

        }

      });

      $c1.on("input change", function (e) {
        var color = $(this).val();
        document.body.style.setProperty("--color1", color);
      });

      $c2.on("input change", function (e) {
        var color = $(this).val();
        document.body.style.setProperty("--color2", color);
      });


      });
  </script>
</body>